<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8">

    <title>Garbage Collection - The Journey Until Java 11</title>

    <meta name="description" content="An overview of Garbage Collection and tweaking it.">
    <meta name="author" content="Chandra Guntur">

    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

    <link rel="stylesheet" href="css/reveal.css">
    <link rel="stylesheet" href="css/theme/dark.css" id="theme">

    <script type="text/javascript" src="js/jquery.min.js"></script>

    <!-- Theme used for syntax highlighting of code -->
    <link rel="stylesheet" href="lib/css/zenburn.css">
    <link rel="icon" type="image/png" href="images/favicon.png" sizes="32x32"/>

    <script>
        // Printing and PDF exports
        var link = document.createElement('link');
        link.rel = 'stylesheet';
        link.type = 'text/css';
        link.href = window.location.search.match(/print-pdf/gi) ? 'css/print/pdf.css' : 'css/print/paper.css';
        document.getElementsByTagName('head')[0].appendChild(link);
    </script>

    <!--[if lt IE 9]>
    <script src="lib/js/html5shiv.js"></script>
    <![endif]-->
</head>

<body>

<div class="reveal">
  <div class="slides">

    <!-- Title slide -->
    <section>
      <h1>Garbage Collection - The Journey Until Java 11</h1>
      <h4>&nbsp;</h4>
      <img src="images/DukeGarbageCollector.png" height="400"/>
      <br>
      <span class="dimtext"><span style="font-size: 0.25em; display: block; text-align: center">
        Below icons are from SuperTinyIcons: <a href="https://github.com/edent/SuperTinyIcons" target="_balnk">https://github.com/edent/SuperTinyIcons</a>
      </span></span>
    </section>

    <!-- about: presenter -->
    <section>
      <h1 style="text-transform: none">about: presenter</h1>
      <span style="font-size:0.7em;text-align:left;margin-left: 50px">
        <table width="100%">
          <tr style="border: hidden">
            <td width="30%" style="text-align: center; vertical-align: middle;border: hidden">
              <img src="scaffolding/chandra.png" width="150px"/><span class="color3">Chandra Guntur</span>
            </td>
            <td width="70%" style="text-align:center; font-size: 0.9em; vertical-align: middle;border: hidden">
              <ul>
                <li>coding since mid-nineties, mostly Smalltalk and Java.</li>
                <li>an evangelist and heavy user of Spring and Spring Boot.</li>
                <li>an organizer/presenter at <span class="color2">NY Java Special Interest Group</span> (<a href="http://www.javasig.com" target="_blank">javasig.com</a>).</li>
                <li>a co-chair of NYJavaSIG Hands On Workshop (<span class="color2">NYJavaSIG HOW</span>).</li>
                <li>committed to <em class="color2">docendo discimus</em> (by teaching, you learn).</li>
                <li>a <strong class="color2">Saganist</strong> ( the <strong class="color2">g</strong> not to be confused with a <strong class="color2">t</strong> ). ðŸ˜ˆ</li>
              </ul>
            </td>
          </tr>
        </table>
        <hr/>
        <table width="100%" style="border: hidden">
        
          <tr style="border: hidden">
            <td width="33%" style="text-align:center; font-size:0.65em;border: hidden">Twitter: <br/><a
                href="http://www.twitter.com/cguntur" target="_blank">http://www.twitter.com/cguntur</a>
            </td>
            <td width="33%" style="text-align:center;font-size:0.65em;border: hidden">LinkedIn: <br/><a
                href="http://www.linkedin.com/in/chandraguntur" target="_blank">http://www.linkedin.com/in/chandraguntur</a>
            </td>
            <td width="34%" style="text-align:center;font-size:0.65em;border: hidden">My blog: <br/><a
                href="http://www.cguntur.me" target="_blank">http://www.cguntur.me</a>
            </td>
          </tr>
        
          <tr>
            <td width="33%" style="text-align:center;border: hidden">
              <a href="http://www.twitter.com/cguntur" target="_blank">
                <img src="scaffolding/twitter_qr.png" width="150"/>
              </a>
            </td>
            <td width="33%" style="text-align:center;border: hidden">
              <a href="http://www.linkedin.com/in/chandraguntur" target="_blank">
                <img src="scaffolding/linkedin_qr.png" width="150"/>
              </a>
            </td>
            <td width="34%" style="text-align:center;border: hidden">
              <a href="http://www.cguntur.me" target="_blank">
                <img src="scaffolding/cguntur_qr.png" width="150"/>
              </a>
            </td>
          </tr>
        
        </table>
      </span>
      <br>
      <span class="dimtext"><span style="font-size: 0.25em; display: block; text-align: center">
      LinkedIn and my blog QR codes generated at QRStuff: <a href="http://www.qrstuff.com" target="_blank">http://www.qrstuff.com</a>.
      </span></span>
    </section>
    
    <!-- Agenda -->
    <section>
      <h2>Agenda</h2>
      <span style="margin-left: 10%">
        Topics covered:<br/>
        <ul style="font-size: 0.75em;line-height: 50px;margin-left: 20%">
          <li>Brief walk-through:<br/>
            <ul>
              <li><span class="dimtext">Garbage Collection - Basics</span></li>
              <li><span class="dimtext">Garbage Collection - Patterns</span></li>
              <li><span class="dimtext">Garbage Collection - Generational</span></li>
            </ul>
          </li>
          <li>G1GC - How it works</li>
          <li>G1GC - Logging Options</li>
          <li>G1GC - Common Tuning Situations</li>
          <li>A discussion (Time permitting):
            <ul>
              <li><span class="dimtext">Garbage Collection - What's Next</span></li>
            </ul>
          </li>
        </ul>
      </span>
    </section>
    
    <!-- GC Basics -->
    <section>

      <!-- Garbage Collection - Basics -->
      <section>
        <h1>Garbage Collection - Basics</h1>
        <span style="font-size:0.75em;text-align:left;">
          <p/>
          <br/>
          As a broad definition, <strong class="color1">garbage collection</strong> is the process of:
          <ul>
            <li>looking up managed memory</li><br/>
            <li>identify all objects that are in use (<em class="color2">live objects</em>)</li><br/>
            <li>mark non-live objects as <em class="color2">garbage</em> (<em class="color2">unused</em> or <em class="color2">no-reference</em> are other common terms)</li><br/>
            <li>[<em class="color2">occasionally</em>] reclaim memory by deleting garbage</li><br/>
            <li>[<em class="color2">occasionally</em>] compact memory defragmenting live objects (create more contiguous space).</li><br/>
          </ul>
          <br/>
          An unused object is one that is no longer referenced by any part of the program.
          <br/>
          <span style="font-size:0.7em;text-align:left;"><span class="color2">History:</span><p/><strong>The first garbage collection process</strong>: Lisp, in 1959 by <strong class="color1">John MacCarthy</strong> (<em>author of Lisp and major contributor to ALGOL</em> fame).</span>
        </span>
      </section>

      <!-- Garbage Collectors - Classification -->
      <section>
        <h2>Garbage Collectors - Classification</h2>
        <p/>
        <span style="font-size:0.55em;text-align:left;">
          Garbage collectors can be classified with several classifiers. Few of those are tabulated below.
          <br/>
          <span class="color3" style="font-size: 0.75em">Below numbering is only for readability. It does not indicate any precedence or priority.</span>
          <table style="font-size: 0.6em;text-align: left; width: 100%">
            
            <tbody>
              <tr>
                <td class="tdfiller">1. Based on how collection runs</td>
                <td class="tdfiller">2. Based on how objects are marked</td>
              </tr>
              <tr>
                <td style="text-align: left; vertical-align: top; width: 50%">
                  <ul>
                    <li><strong class="color1">Serial collector</strong>: Single GC thread, halting all application threads &rarr; <strong class="color2">STOP THE WORLD</strong> </li>
                    <li><strong class="color1">Parallel collector</strong>: Multiple GC threads in parallel, halting all application threads &rarr; <strong class="color2">STOP THE WORLD</strong></li>
                    <li><strong class="color1">Concurrent collector</strong>: GC thread(s) concurrently run with the application threads &rarr; <strong class="color2">CONCURRENT</strong></li>
                  </ul>
                  &nbsp;&nbsp;&nbsp;&nbsp;<span style="font-size: 0.7em"><strong class="color2">Note</strong><span class="color2">: Parallel and concurrent are two different things.</span></span>
                </td>
                <td style="text-align: left; vertical-align: top">
                  <ul>
                    <li><strong class="color1">Precise</strong>: When the collector can fully identify and process all references at the time of collection.</li>
                    <li><strong class="color1">Conservative</strong>: When collector cannot/has not fully identified references to a certain object, it assumes a reference to it exists.</li>
                  </ul>
                  <br/>
                </td>
              </tr>
            
              <tr>
                <td class="tdfiller">3. Based on run interval of collections</td>
                <td class="tdfiller">4. Based on what collection does to objects</td>
              </tr>
              <tr>
                <td style="text-align: left; vertical-align: top; width: 50%">
                  <ul>
                    <li><strong class="color1">All-at-once</strong>: Entire GC operation performed in a single run.</li>
                    <li><strong class="color1">Incremental</strong>: GC operations are sliced into smaller operations, to be more performant.</li>
                  </ul>
                </td>
                <td style="text-align: left; vertical-align: top">
                  <ul>
                    <li><strong class="color1">Moving</strong>: When reachable objects are moved to a new area of memory (a.k.a compacting).</li>
                    <li><strong class="color1">Non-moving</strong>: When unreachable objects are simply released (a.k.a non-compacting).</li>
                  </ul>
                  <br/>
                </td>
              </tr>

            </tbody>

          </table>
        </span>

      </section>

    </section>

    <!-- GC Patterns -->
    <section>

      <!-- Garbage Collection - Patterns -->
      <section>
        <h2>Garbage Collection - Patterns</h2>
        <span style="font-size:0.75em;text-align:left;">
          <p/>This section will list a few garbage collection patterns.
        </span>
      </section>

      <!-- Garbage Collection - Reference Counting -->
      <section>
        <h2>Garbage Collection - Reference Counting</h2>
        <table style="width: 100%;font-size:0.65em;margin-left: 0px;border: hidden">
          <tr style="border: hidden">
            <td width="60%" style="vertical-align: middle;border: hidden">
              <span style="text-align:left;">
                <p/>The most rudimentary garbage collection is based on <em class="color1 dimbg">references</em>:
                <ul>
                  <li>associates a reference counter to each object</li><br/>
                  <li><span class="color2">increments</span> the counter for each reference to the object.</li><br/>
                  <li><span class="color2">decrements</span> the counter for each de-reference of the object.</li><br/>
                  <li>marks object as garbage, if reference count reaches zero.</li><br/>
                  <li>is very under-performant and maintenance-heavy for JVMs.</li><br/>
                  <li>is considered <strong class="color3">obsolete</strong> in commercial JVMs.</li><br/>
                </ul>
                <p/>
                Memory allocator may place objects anywhere in the free space.
            </span>
            </td>
            <td width="40%" style="text-align: center; vertical-align: middle;border: hidden">
              <img src="images/CollectionType_ReferenceCounting.png" width="100%"/>
            </td>
          </tr>
        </table>
        <!--</span>-->
      </section>

      <!-- Garbage Collection - Mark/Sweep/Compact -->
      <section>
        <h2>Garbage Collection - Mark/Sweep/Compact</h2>
        <table style="width: 100%;font-size:0.65em;margin-left: 0px;border: hidden">
          <tr style="border:hidden">
            <td width="60%" style="vertical-align: middle;border: hidden">
              <span style="text-align:left;">
                <p/>The mark/sweep collection pattern is based on <em class="color1 dimbg">tracing</em>:
                <ul>
                  <li>includes a <em class="color1">tri-color marker</em>: <span class="color3">gray</span>, <span class="color3">black</span> or <span class="color3">white</span> on each object.</li><br/>
                  <li>all markers set to <span class="color2">unchecked <span class="color3">(gray)</span></span> before the collection cycle.</li><br/>
                  <li>evaluates such, as <span class="color2">in-use <span class="color3">(black)</span></span> or <span class="color2">unreferenced <span class="color3">(white)</span></span>.</li><br/>
                  <li>objects checked only once since marker is painted black or white.</li><br/>
                  <li>sweeps the <span class="color2">unreferenced (white)</span> marked objects.</li><br/>
                  <li>collection ends when the <span class="color2">unchecked (gray)</span> set is empty.</li><br/>
                  <li><span class="dimtext">(optionally/periodically)</span> compact/defragment space.</li><br/>
                </ul>
            </span>
            </td>
            <td width="40%" style="text-align: center; vertical-align: middle;border: hidden">
              <img src="images/CollectionType_MarkSweepCompact.png" width="100%"/>
            </td>
          </tr>
        </table>
        <span style="font-size: 0.5em">
          Memory allocator moves pointer to the beginning of free space.
          <br/>
          Objects are added after the free memory pointer.
        </span>
      </section>

      <!-- Garbage Collection - Copying -->
      <section>
        <h2>Garbage Collection - Copying</h2>
        <table style="width: 100%;font-size:0.60em;margin-left: 0px;border: hidden">
          <tr style="border:hidden">
            <td width="60%" style="vertical-align: middle;border: hidden">
              <span style="text-align:left;">
                <p/>The copying garbage collection is based on <em class="color1 dimbg">tracing</em>:
                <ul>
                  <li>includes a <em class="color1">tri-color marker</em>: <span class="color3">gray</span>, <span class="color3">black</span> or <span class="color3">white</span> on each object.</li><br/>
                  <li>all markers set to <span class="color2">unchecked <span class="color3">(gray)</span></span> before the collection cycle.</li><br/>
                  <li>evaluates such, as <span class="color2">in-use <span class="color3">(black)</span></span> or <span class="color2">unreferenced <span class="color3">(white)</span></span>.</li><br/>
                  <li>objects checked only once since marker is painted black or white.</li><br/>
                  <li><span class="color3">very specialized case of <strong class="color2">M/S/C</strong></span>.</li><br/>
                  <li>has a <strong class="color1">from</strong> and a <strong class="color1">to</strong> memory area which <strong class="color2">swap for each GC cycle</strong>.</li><br/>
                  <li>copies live objects to another memory area.</li><br/>
                  <li>purges current area, <strong class="color2">one of the two areas is always empty</strong>.</li><br/>
                </ul>
            </span>
            </td>
            <td width="40%" style="text-align: center; vertical-align: middle;border: hidden">
              <img src="images/CollectionType_Copying.png" width="100%"/>
            </td>
          </tr>
        </table>
        <span style="font-size: 0.4em">
          Memory allocator moves pointer to the beginning of free space in the new memory area.
          <p/>
          Objects are added sequentially after the free memory pointer.</span>
      </section>
      
      <section>
        <h2>Garbage Collection - Patterns Usage</h2>
        <span style="font-size: 0.65em;"></span>
        <table style="font-size: 0.6em;text-align: left; width: 100%">
    
          <tbody>
          <tr>
            <td class="tdfiller">Mark/Sweep/Compact</td>
            <td class="tdfiller">Copying</td>
          </tr>
          <tr>
            <td style="text-align: left; vertical-align: top; width: 50%">
              <ul>
                <li><span class="color2">efficient for larger memory areas</span>.</li>
                <li>works best on <span class="color2">longer-lived non-volatile objects</span>.</li>
                <li><span class="color1">incremental</span> collector, doesn't need a lot of free space to run.</li>
                <li><span class="color2">either</span> <span class="color1">concurrent</span> (CMS) or <span class="color1">stop-the-world</span> (STW M/S/C).</li>
              </ul>
            </td>
            <td style="text-align: left; vertical-align: top; width: 50%">
              <ul>
                <li><span class="color2">efficient for small memory areas</span>.</li>
                <li>works best on <span class="color2">short-lived objects</span>.</li>
                <li><span class="color1">all-at-once</span> collector that needs 2x the memory space to run.</li>
                <li><span class="color1">stop-the-world</span> collector.</li>
              </ul>
            </td>
          </tr>
          </tbody>
        </table>
      </section>

    </section>
  
    <!-- Generational GC -->
    <section>

      <!-- Garbage Collection - Generational -->
      <section>
        <h2>Garbage Collection - Generational</h2>
        <span style="font-size:0.65em;text-align:left;">
          Java, since JDK 5 has had a generational garbage collector as its default.
          <p/>
          The generational collector divides the memory into smaller memory areas.
          <p/>
          Management of objects in different memory areas is done differently.
          <p/>
          <strong><span class="color1">Weak Generational Hypothesis</span> : </strong>
          <br/>
          <ul>
            <li>Most objects do not have a long life.</li>
            <li>It is usually rare for an older generation object to reference a young generation object.</li>
          </ul>
          <p>
        </span>
      </section>

      <!-- Generational GC - Pictorial -->
      <section>
        <h2>Generational GC - Pictorial</h2>
        <span style="font-size:0.65em;text-align:left;">
          <strong><span class="color1">Overview</span> : </strong>
          <br/>
          <ul>
            <li>Objects initially allocated to the young <strong class="color1">Eden</strong> region.</li>
            <li>Objects that live past a collection are <em class="color2">promoted</em> to <strong class="color1">Survivor</strong> and subsequently to <strong class="color1">Tenured</strong>.</li>
            <li>Collection patterns can be different for each generation to deliver an optimal performance.</li>
          </ul>
          <p>
          <img src="images/GenerationalGarbageCollection.png" width="65%"/>
        </span>
        <br>
        <span class="dimtext"><span style="font-size: 0.35em; display: block; text-align: center">
        Picture influenced by JÃ¶rg Prante's writeup: <a href="http://jprante.github.io/2012/11/28/Elasticsearch-Java-Virtual-Machine-settings-explained.html" target="_balnk">http://jprante.github.io/2012/11/28/Elasticsearch-Java-Virtual-Machine-settings-explained.html</a>
        </span></span>
      </section>

      <!-- Generational GC - Collection -->
      <section>
        <h2>Generational GC - Collection</h2>
        <span style="font-size:0.6em;text-align:left;">
          <strong><span class="color1">Explanation</span>: </strong>
          <br/>
          <ul>
            <li>heap is broken into smaller areas (sub-heaps).</li><br/>
            <li>newly created objects are allocated to a young area called <strong class="color1">Eden</strong>.</li><br/>
            <li>there is a per-thread region for reducing synchronization - <strong class="color1">Thread Local Allocation Buffer (TLAB)</strong></li><br/>
            <li><span class="color1">Eden</span> itself divided into TLAB sections for individual threads and a common area.</li><br/>
            <li>different GC processes for each generation, young gc typically is <span class="color2">all-at-once</span>, <span class="color2">stop-the-world</span>, <span class="color2">copying</span> collector.</li><br/>
            <li>objects that stay "alive" longer get moved to older generation.</li><br/>
            <li><strong class="color1">Permanent Generation</strong> is for storing class/method definitions and static content.</li><br/>
          </ul>
          
        </span>
      </section>

      <!-- Generational GC - Steps -->
      <section>
        <h2>Generational GC - Steps</h2>
        <span style="font-size:0.65em;text-align:left;">
          <strong><span class="color1">Typical steps in a Generational GC</span>: </strong>
          <br/>
          <table style="width:100%;">
            <tr>
              <td width="75%" style="font-size: 1.0em; vertical-align: middle;border: hidden">
              <!--<td width="70%" style="font-size: 1.0em; vertical-align: middle;">-->
                <span style="font-size:0.85em;text-align:left;">
                  <br/>
                    <ol>
                      <li>Objects first allocated into <strong class="color1">Eden</strong>.</li><br/>
                      <li>On first GC, live objects from <span class="color1">Eden</span> moved to <strong class="color1">Survivor 1</strong>.</li><br/>
                      <li>All moved live objects from <span class="color1">Eden</span> marked with an <strong class="color2">Age (tenure)</strong> of <span class="color3">1</span>.</li><br/>
                      <li><span class="color1">Eden</span> cleared and ready to allocate new objects.</li><br/>
                      <li>Next GC, collects live objects from <span class="color1">Eden</span> and <span class="color1">Survivor <em>From</em></span> into <strong class="color1">Survivor <em>To</em></strong>.</li><br/>
                      <li>Objects from <span class="color1">Survivor <em>From</em></span> get <span class="color2">Age</span> incremented by <span class="color3">1</span>, objects from Eden get an <span class="color2">Age</span> of <span class="color3">1</span>.</li><br/>
                      <li><span class="color1">Eden</span> cleared and ready to allocate new objects.</li><br/>
                      <li><strong class="dimtext">Steps 5, 6, 7</strong> recur flipping <span class="color1">Survivor 1</span> and <span class="color1">Survivor 2</span> as <em class="color1">From</em> and <em class="color1">To</em>.</li><br/>
                      <li> Done until <span class="color2">Age</span> threshold (default = <span class="color3">15</span>) reached for any live object.</li><br/>
                      <li>Next GC, live objects from the current <span class="color1">Survivor</span> with <span class="color2">Age</span> above threshold, move to <strong class="color1">Tenured</strong>.</li><br/>
                      <li><strong class="dimtext">Steps 5 - 10</strong> recur until a need for a full GC.</li><br/>
                    </ol>
                </span>
              </td>
              <td width="30%" style="text-align: center; vertical-align: middle; border: hidden">
              <!--<td width="30%" style="text-align: center; vertical-align: middle;">-->
                <img src="images/GenerationalMemoryAreas.png" width="100%"/>
              </td>
            </tr>
          </table>
          
        </span>
      </section>

      <!-- Generational GC - Types - Older -->
      <section>
        <h2>Generational GC - Types - Older</h2>
        <span style="font-size:0.6em;text-align:left;">
          There are a few different types of collectors:<br/>
          <ul>
            <li><strong class="color2">Serial Collector</strong> <br/>
              <ul>
                <li>Freezes all application threads to collect garbage.</li>
                <li>Designed for single-thread and tiny heap sized (~100 MB) apps.</li>
                <li>Low memory footprint makes it good for <strong class="color1"></strong> for mobile or small apps.</li>
              </ul>
            </li><br/>
            <li><strong class="color2">Parallel Collector a.k.a Throughput collector - Java 1.5 onwards, default collector Java 1.5, 1.6, 1.7 and 1.8 (<span class="color3"><sub>*</sub> &darr;</span>) </strong> <br/>
              <ul>
                <li><strong class="color1 dimbg">Young</strong> gen., only has the <span class="color2">parallel (scavenge) collection</span>.</li>
                <li><strong class="color1 dimbg">Tenured</strong> gen. earlier had a default <span class="color2">serial collector</span> (later versions changed default to <span class="color2">parallel old collector</span>).</li>
                <li> (<span class="color3"><sub>*</sub></span>)  <em>G1GC was originally planned as default for Java 1.8 but was deferred until Java 9</em>.</li>
              </ul>
            </li><br/>
            <li><strong class="color2">Concurrent Mark-Sweep (CMS) Collector (mostly*) - available Java 1.5 onwards until Java 1.8</strong> <br/>
              <ul>
                <li>By default, <strong class="color1 dimbg">Young</strong> gen. uses a serial collection and <strong class="color1 dimbg">Tenured</strong> gen. use a CMS collector.</li>
                <li>Does not <span class="color1">compact</span> by default, to make GC a low-pause, low-latency, but causes heap fragmentation.</li>
                <li><em class="color2">An eventual fill up of old memory causes a fall-back to a STW M/S/C that results in performance degradation</em>.</li>
                <li><strong>Focuses on live objects and defers garbage handling, until crisis time.</strong> </li>
                <li>ParNew does the synchronization needed for CMS that Parallel Scavenge cannot.</li>
              </ul>
            </li>
          </ul>
        </span>
      </section>

      <!-- Generational GC - Types - Why New -->
      <section>
        <h2>Generational GC - Types - Why New</h2>
        <span style="font-size:0.6em;text-align:left;">
          Some notes on the existing garbage collectors:<br/>
          <ul>
            <li style="margin-top: 1.0em">Mostly <span class="color2">focused on live objects</span>, not on garbage (an exact antithesis of the name).</li>
            <li style="margin-top: 1.0em">The <span class="color2">contiguous memory area arrangement</span> reduces flexibility of "moving the walls".</li>
            <li style="margin-top: 1.0em">Required different collectors on <strong>young</strong> and <strong>tenured generations</strong> to achieve performance benefits.</li>
            <li style="margin-top: 1.0em">By default, <span class="color2">unpredictable and inconsistent pause-times</span> and lesser number of STW GCs.</li>
            <li style="margin-top: 1.0em">Need heavy tune-ups to stabilize pause times due to non-compacting nature of recent collectors.</li>
            <li style="margin-top: 1.0em">Not performant for <span class="color2">large memory heaps</span> (<span class="dimtext">large heaps are common these days</span>).</li>
            <li style="margin-top: 1.0em"><em class="dimbg">Either</em> highly prone to fragmentation <em class="dimbg">or</em> demand the need for smaller heaps for predictable times.</li>
            <li style="margin-top: 1.0em">Not much effort put into re-use of duplicated content.</li>
          </ul>
          <p/>
          <span class="color1" style="font-size: 1.2em">
            The G1GC (<strong class="color2">Garbage First Garbage Collector</strong>), was designed and developed to resolve the above.
            <br/>
            <blockquote class="color3" style="font-size: 0.8em; text-align: center">G1GC is the new default collector since JDK 9.</blockquote>
          </span>
        </span>
      </section>
    </section>
    
    <!-- G1GC -->
    <section>
      
      <!-- Garbage First Garbage Collector -->
      <section>
        <h2>Garbage First Garbage Collector</h2>
        <span style="font-size:0.65em;text-align:left;">
          Java 9 introduced a new <span class="color2">default</span> Generational Garbage Collector.
          <p/>
          This new collector is called <span class="color1">Garbage First Garbage Collector (G1GC)</span>.<br/>
          <br/>
          <img src="images/G1MemoryAllocation.png" width="55%"/>
        </span>
        <p/>
        <span class="dimtext"><span style="font-size: 0.45em; display: block; text-align: center">
        Recommended slide deck: <a href="https://www.slideshare.net/MonicaBeckwith/java-9-the-g1-gc-awakens">https://www.slideshare.net/MonicaBeckwith/java-9-the-g1-gc-awakens</a>.
        </span></span>
      </section>
  
      <!-- Garbage First Garbage Collector - Regions-->
      <section>
        <h2>Garbage First Garbage Collector - Regions</h2>
        <span style="font-size:0.65em;text-align:left;">
          Each <span class="color2">block</span> of memory is called a <strong class="color1">Region</strong>.
          <p/>
          Heap is compartmentalized into virtual non-contiguous memory regions.<br/>
          <br/>
          <img src="images/G1MemoryRegion.png" width="55%"/>
        </span>
      </section>
  
      <!-- G1GC - Regions -->
      <section>
        <h2>G1GC - Regions</h2>
        <span style="font-size:0.75em;text-align:left;">
          <strong><em><span class="color1">Some observations</span> </em>: </strong>
          <br/>
          <ul style="font-size: 0.9em">
            <li style="margin-top: 0.5em">A <strong class="color2">region</strong> is a contiguous unit of memory allocation and space reclamation.</li><br/>
            <li style="margin-top: 0.5em">Regions are formed by <strong class="color2">dividing the heap into ~ 2048 or more blocks</strong> of <strong class="color2">equal size</strong>.</li><br/>
            <li style="margin-top: 0.5em">The region <strong class="color2">sizes can range from 1 MB to 32 MB</strong> depending on the heap size.</li><br/>
            <li style="margin-top: 0.5em">The <strong class="color2">memory manager</strong> assigns a region as <span class="color1">free</span>, <span class="color1">eden</span>, <span class="color1">survivor</span>, <span class="color1">tenured</span> or part of a <span class="color1">humongous</span> allocation.</li><br/>
            <li style="margin-top: 0.5em"><strong class="color1">Humongous</strong> objects occupy complete (<em class="color2">for larger objects, contiguous</em>) regions.</li><br/>
            <li style="margin-top: 0.5em"><strong class="color1">Humongous</strong> objects are defined as objects with <strong class="color2">size > 50% of region size</strong>.</li><br/>
            <li style="margin-top: 0.5em"><strong class="color1">Humongous</strong> objects are <strong class="color2">not allocated in </strong><span class="color1">young regions</span>.</li><br/>
            <li style="margin-top: 0.5em">G1GC has a <strong class="color2">consistent pause time-target that it tries to meet</strong> (soft, real time), hence region sizes are controlled.</li><br/>
          </ul>
        </span>
      </section>
  
      <!-- G1GC - Region Math -->
      <section>
        <h2>G1GC - Region Math</h2>
        <span style="font-size:0.65em;text-align:left;">
          <!--<table width="100%">-->
            <!--<tr style="border: hidden">-->
              <!--<td width="70%" style="font-size: 1.0em; vertical-align: middle;border: hidden">-->
                <!--<span style="font-size:0.8em;text-align:left;">-->
                  <strong class="color1">Calculating regions on a <span class="color3">9GB</span> heap</strong><br/><p/>
                  <ol>
                    <li>Convert heap size to MB &rarr; <span class="color2">9GB = 9 x 1024 MB = </span><strong class="color3">9216 MB</strong>.</li><br/>
                    <li><em class="color2">Approximate</em> region size for 2048 regions &rarr; <span class="color2">9216 MB &divide; 2048 regions = </span><strong class="color3 dimbg">4.5 MB per region</strong> </li><br/>
                    <li>Regions for factor of 2 <em class="color1">below</em> the approximate region size (= <span class="color3">4</span>) &rarr; <span class="color2">9216 &divide; <span class="dimbg">4MB</span> = </span><strong class="color3">2304 regions</strong>.</li><br/>
                    <li>Regions for factor of 2 <em class="color1">above</em> the approximate region size (= <span class="color3">8</span>) &rarr; <span class="color2">9216 &divide; <span class="dimbg">8MB</span> = </span><strong class="color3">1152 regions</strong>.</li><br/>
                    <li>Since <strong class="color3">2304</strong> is closest to and above <span class="color3">2048</span>, it is chosen as the number of regions to use.</li><br/>
                    <li>Each region, <em class="color2">in this example</em>, is calculated to be <strong class="color3">4MB</strong> size.</li><br/>
                    <li><strong class="color1">Humongous</strong> objects, <em class="color2">in this example</em>, are any objects of size <strong class="color3">2MB</strong> or above.</li><br/>
                    <li>A <span class="color3">2.5MB</span> object occupies <span class="color2">one</span> region, a <span class="color3">13MB</span> object will occupy <span class="color2">four</span> contiguous regions.</li><br/>
                    <li>Possible to disable this auto-calculation by setting a JVM option that overrides calculating.</li><br/>
                    <li>Set the flag <code>-XX:G1HeapRegionSize</code> with a numeric value (that is a power of <span class="color3">2</span>).</li><br/>
                  </ol>
                <!--</span>-->
              <!--</td>-->
              <!--<td width="30%" style="text-align: center; vertical-align: middle; border: hidden">-->
                <!--<img src="images/G1MemoryAllocation.png" width="100%"/>-->
              <!--</td>-->
            <!--</tr>-->
          <!--</table>-->
        </span>
      </section>
  
      <!-- G1GC - Explanation (Picture) -->
      <section>
        <h2>G1GC - Explanation (Picture)</h2>
        <span style="font-size:0.65em;text-align:left;">
          Below is a pictorial of how G1GC works under <em class="color2">normal</em> circumstances.
          <strong><em><span class="color1">Some notes</span> </em>: </strong>
          <br/>
          <ul style="font-size: 0.9em">
            <li style="margin-top: 0.5em">The <span class="color2">top semicircle</span> is the most common GC process.</li>
            <li style="margin-top: 0.5em">When space is too fragmented or tenured occupancy hits a threshold, the <span class="color2">bottom semi-circle</span> is triggered.</li>
            <li style="margin-top: 0.5em">Eventually, <strong class="dimbg color2">neither process</strong> of the above will create contiguous memory for new allocations.
              <ul>
                <li style="margin-top: 0.5em"><strong class="color1 dimbg">Until Java 9</strong>: Heavy heap occupancy will eventually lead to a <strong class="color3">Serial</strong> collecting Full GC(single-threaded).</li>
                <li style="margin-top: 0.5em"><strong class="color1 dimbg">From Java 10</strong>: Heavy heap occupancy will eventually lead to a <strong class="color3">Parallel</strong> collecting Full GC (multi-threaded).</li>
              </ul>
            </li>
          </ul>
          <br/>
          <img src="images/G1GC_Cycle.png" width="45%"/>
        </span>
      </section>
      
      <!-- G1GC - Explanation -->
      <section>
        <h2>G1GC - Explanation</h2>
        <span style="font-size:0.52em;text-align:left;">
          <table width="100%">
            <tr style="border: hidden">
              <td width="65%" style="font-size: 1.0em; vertical-align: middle;border: hidden">
                <span class="color1">Explanation: </span><br/>
                <ul>
                  <li style="margin-top: 0.35em"><em class="color2">each circle</em> represents a STW process.</li>
                  <li style="margin-top: 0.35em">two distinct phases of collection.</li>
                  <li style="margin-top: 0.35em">starts with a <strong class="color3">Young-only</strong> phase.</li>
                  <li style="margin-top: 0.35em"> <strong class="color1 dimbg">Young Collection</strong> runs periodically on a <strong class="color2">Collection set (CSet)</strong>.</li>
                  <li style="margin-top: 0.35em">continues until a <em class="color2">threshold</em> is reached, which triggers an <strong class="color1 dimbg">Initial Mark</strong>.</li>
                  <li style="margin-top: 0.35em"><span class="color1">Initial Mark</span> triggers <span class="color2">concurrent marking</span> in addition to the <span class="color1">young collection</span>.</li>
                  <li style="margin-top: 0.35em"><span class="color1">Root scanning</span> will halt the <span class="color2">young collection</span> process during this phase.</li>
                  <li style="margin-top: 0.35em"><strong class="color1 dimbg">Concurrent Mark</strong> takes a while, <span class="color1">Young Collection</span> could continue along-side.</li>
                  <li style="margin-top: 0.35em">at end of <span class="color1">Concurrent Mark</span>, a <strong class="color1 dimbg">Remark</strong> is initiated.</li>
                  <li style="margin-top: 0.35em"><span class="color1">Remark</span> finalizes marking, summarizes liveness.</li>
                  <li style="margin-top: 0.35em"><span class="color1">Remark</span> completion triggers <strong class="color1 dimbg">Cleanup</strong>, reclaiming empty regions.</li>
                  <li style="margin-top: 0.35em"><span class="color1">Cleanup</span> is used to determine if <span class="color1">Tenured</span> space reclamation required.</li>
                  <li style="margin-top: 0.35em">Crossing <span class="color2">Heap waste percentage</span> threshold triggers <strong class="color3">Space reclamation</strong> phase.</li>
                  <li style="margin-top: 0.35em">A <strong class="color2">Collection set (CSet)</strong> of <span class="color1">Young</span> &amp; <span class="color1">Tenured</span> regions picked for collection.</li>
                  <li style="margin-top: 0.35em">This <strong class="color1 dimbg"> Mixed Collection</strong> is made up to meet a <em class="color2">pause-time goal</em>.</li>
                  <li style="margin-top: 0.35em">References to objects (in same generation or inter-generational) are tracked.</li>
                  <li style="margin-top: 0.35em">References are tracked via <strong class="color2">Remembered sets (RSets)</strong> in a <span class="color2">Card table</span>.</li>
                  <li style="margin-top: 0.35em"><span class="color1">Mixed Collection</span> continues until heap waste percent below threshold.</li>
                  <li style="margin-top: 0.35em"><span class="color2">Humongous objects</span> processed in <span class="color1">Cleanup</span> phase and during <strong class="color2">Full GC</strong> .</li>
                </ul>
              </td>
              <td width="100%" style="text-align: center; vertical-align: middle; border: hidden">
                <img src="images/G1GC_Cycle.png"/>
              </td>
            </tr>
          </table>
        </span>
        <p/>
        <span class="dimtext"><span style="font-size: 0.35em; display: block; text-align: center">
        Visual influenced by the Oracle GC Tuning Guide: <a href="https://docs.oracle.com/javase/9/gctuning/garbage-first-garbage-collector.htm" target="_balnk">https://docs.oracle.com/javase/9/gctuning/garbage-first-garbage-collector.htm</a>
        </span></span>
      </section>
      
      <section>
        <h2>G1GC - Young Collection - Steps</h2>
        <ol style="font-size: 0.6em">
          <li style="margin-top: 0.5em"><strong class="color2">Root Scanning</strong>: Scan local and static objects for root objects and mark in a <em class="color2">"dirty queue"</em>.</li>
          <li style="margin-top: 0.5em"><strong class="color2">Update Remembered Set (RSet)</strong>: All marked references in the <span class="color2">dirty queue</span> updated into a <strong class="color2">RSet</strong>.</li>
          <li style="margin-top: 0.5em"><strong class="color2">Process RSet</strong>: Detect references to objects in the <em class="color2">collection set</em> <strong class="color1">Young</strong> regions, from objects in <strong class="color1">Tenured</strong> regions.</li>
          <li style="margin-top: 0.5em"><strong class="color2">Copy Live Objects</strong>: Traverse the object graph and <em class="color2">promote/age</em> live objects.</li>
          <li style="margin-top: 0.5em"><strong class="color2">Process references</strong>: Update references to new location, process soft, weak, phantom and final references.
            <ul style="font-size: 0.9em">
              <br/><li><strong class="color1">StrongReference</strong>: Typical pointer allocation to an object, re-pointing to null will cause object to be collected.</li><br/>
              <li><strong class="color1">SoftReference</strong>: The reference is kept unless there is no other space for any new allocation.</li><br/>
              <li><strong class="color1">WeakReference</strong>: The reference is collected as soon as GC reaches it.</li><br/>
              <li><strong class="color1">PhantomReference</strong>: The reference enqueued for collection, retained until all references to it are either dead/weak references.</li><br/>
            </ul>
          </li>
        </ol>
      </section>
      
      <!-- G1GC - Young-Only (Survivor Promotion) -->
      <section>
        <h2>G1GC - Young-Only #1 (Survivor Promotion)</h2>
        <table style="width: 100%">
          <tr style="border: hidden">
            <td width="80%" style="text-align: left; vertical-align: middle; border: hidden">
              <span style="font-size:0.55em;text-align:left;">
                <strong><span class="color1">Young Collection (Eden &amp; Survivor<sub><span style="font-size: 0.7em">F</span></sub> &rarr; Survivor<sub><span style="font-size: 0.7em">T</span> </sub>)</span>: </strong>
                <br/>
                <ul style="font-size: 0.9em">
                  <li><span class="color1">Young Collection</span> builds a CollectionSet with some <span class="color1">Eden</span> and <span class="color1">Survivor</span> regions.</li>
                  <li><span class="color1">Young Collection</span> eventually targets all young regions.</li>
                  <li><span class="color1">Eden</span> region live objects have <span class="color2">Age</span> set to <span class="color3">1</span> and moved to a <span class="color1">Survivor <em>To</em></span> region.</li>
                  <li><span class="color1">Survivor <em>From</em></span> region objects with <span class="color2">Age</span> <span class="color3">+1</span> <em><strong class="dimtext">below</strong></em> threshold (default = <span class="color3">15</span>) are moved to a <strong class="color1">Survivor <em>To</em></strong> region. </li>
                  <li><span class="color1">Survivor <em>From</em></span> region objects with <span class="color2">Age</span> <span class="color3">+1</span> <em><strong class="color2 dimbg">above</strong></em> threshold (default = <span class="color3">15</span>) are moved to <strong class="color1">Tenured</strong> region. </li>
                </ul>
              </span>
            </td>
            <td width="20%" style="text-align: center; vertical-align: middle; border: hidden">
              <img src="images/G1GC_Cycle_YoungCollection.png" width="100%"/>
            </td>
          </tr>
        </table>
        <hr/>
        <table style="width: 100%">
          <tr style="border: hidden">
            <td width="50%" style="text-align: center; vertical-align: middle; border: hidden">
              <img src="images/G1_1_YoungCollectionBefore.png" width="100%"/>
            </td>
            <td width="50%" style="text-align: center; vertical-align: middle; border: hidden">
              <img src="images/G1_1_YoungCollectionAfter.png" width="100%"/>
            </td>
          </tr>
        </table>
      </section>
  
      <!-- G1GC - Young-Only (Tenured Promotion) -->
      <section>
        <h2>G1GC - Young-Only #2 (Tenured Promotion)</h2>
        <table style="width: 100%">
          <tr style="border: hidden">
            <td width="80%" style="text-align: left; vertical-align: middle; border: hidden">
              <span style="font-size:0.55em;text-align:left;">
                <strong><span class="color1">Young Collection (Survivor &rarr; Tenured)</span>: </strong>
                <br/>
                <ul style="font-size: 1.0em">
                  <li><span class="color1">Young Collection</span> builds a CollectionSet with some <span class="color1">Eden</span> and <span class="color1">Survivor</span> regions.</li>
                  <li>Evaluation before <span class="color2">Age</span> increment, to determine move location, then <span class="color2">Age</span> incremented and objects moved.</li>
                  <li><span class="color1">Survivor <em>From</em></span> region objects with <span class="color2">Age</span> <span class="color3">+1</span> <em><strong class="dimtext">below</strong></em> threshold (default = <span class="color3">15</span>) are moved to a <strong class="color1">Survivor <em>To</em></strong> region. </li>
                  <li><span class="color1">Survivor <em>From</em></span> region objects with <span class="color2">Age</span> <span class="color3">+1</span> <em><strong class="color2 dimbg">above</strong></em> threshold (default = <span class="color3">15</span>) are moved to <strong class="color1">Tenured</strong> region. </li>
                </ul>
              </span>
            </td>
            <td width="20%" style="text-align: center; vertical-align: middle; border: hidden">
              <img src="images/G1GC_Cycle_YoungCollection.png" width="100%"/>
            </td>
          </tr>
        </table>
        <hr/>
        <table width="100%">
          <tr style="border: hidden">
            <td width="50%" style="text-align: center; vertical-align: middle; border: hidden">
              <img src="images/G1_2_YoungPromotionBefore.png" width="100%"/>
            </td>
            <td width="50%" style="text-align: center; vertical-align: middle; border: hidden">
              <img src="images/G1_2_YoungPromotionAfter.png" width="100%"/>
            </td>
          </tr>
        </table>
      </section>
  
      <!-- G1GC - Initial Mark -->
      <section>
        <h2>G1GC - Initial Mark</h2>
        <table style="width: 100%">
          <tr style="border: hidden">
            <td width="80%" style="text-align: left; vertical-align: middle; border: hidden">
              <span style="font-size:0.55em;text-align:left;">
                <strong><span class="color1">Young-Only - Initial Mark</span>: </strong>
                <br/>
                <ul style="font-size: 0.9em">
                  <li>Triggered when a % of heap is occupied <span class="dimtext"> - or - </span> when the <span class="color1">Survivor <em>To</em></span> minimum creation space threshold is reached.</li>
                  <li>Piggy backs on <span class="dimtext">- and -</span> starts with a <span class="color1">Young Collection</span> (a CollectionSet with some <span class="color1">Eden</span> and <span class="color1">Survivor</span> regions).</li>
                  <li>Mark <span class="color1">Survivor</span> regions that have references to objects in <span class="color1">Tenured</span> regions.</li>
                  <li>Triggers the concurrent <span class="color1">Root Region scans</span> and <span class="color1">Concurrent Marking</span> processes.</li>
                  <li>As the name suggests, this is just a <span class="color2">marking</span> process, <span class="color1">Young Collection</span> continues during the marking.</li>
                </ul>
              </span>
            </td>
            <td width="20%" style="text-align: center; vertical-align: middle; border: hidden">
              <img src="images/G1GC_Cycle_InitialMark.png" width="100%"/>
            </td>
          </tr>
        </table>
        <hr/>
        <table width="100%">
          <tr style="border: hidden">
            <td width="50%" style="text-align: center; vertical-align: middle; border: hidden">
              <img src="images/G1_3_InitialMarkBefore.png" width="100%"/>
            </td>
            <td width="50%" style="text-align: center; vertical-align: middle; border: hidden">
              <img src="images/G1_3_InitialMarkAfter.png" width="100%"/>
            </td>
          </tr>
        </table>
      </section>
  
      <!-- G1GC - What triggers Initial Mark -->
      <section>
        <h2>G1GC - What triggers Initial Mark</h2>
        <span style="font-size:0.7em;text-align:left;">
          <strong><em><span class="color1">What triggers the Initial Mark</span> </em>: </strong>
          <br/>
          <ul style="font-size: 0.8em">
            <li><strong class="color2">Initiating Heap Occupancy Percent (IHOP)</strong> &Rarr; <code>-XX:InitiatingHeapOccupancyPercent</code>: <br/>
              <ul>
                <li>Default value is <span class="color3">45</span>, thus an Initial Mark is triggered when old gen heap size is 45% filled.</li>
                <li>This is just an initiating value. G1 determines via measurement what the optimal percentage should be.</li>
                <li>Such an adaptive HOP can be turned off by un-setting the flag (<span class="dimtext">notice the -</span>): <code>-XX:-G1UseAdaptiveIHOP</code>.</li>
                <li>Turning off the Adaptive IHOP will make the G1 collector rely on the IHOP value alone.</li>
                <li>This value is usually considered a <em class="color2">soft threshold</em>, reaching this limit <em class="color1">may not</em> immediately trigger <span class="color2">Initial Mark</span>.</li>
              </ul>
            </li>
          </ul>
          <br/><br/>
          <ul style="font-size: 0.8em">
            <li><strong class="color2">Guaranteed Survivor Space Availability Percent</strong> &Rarr; <code>-XX:G1ReservePercent</code>: <br/>
              <ul>
                <li>Default value is <span class="color3">10</span>, thus an Initial Mark is triggered when survivor space availability falls to 10% filled.</li>
                <li>This is a flat unchanging value. G1 honors the value set during startup.</li>
                <li>This value supersedes the Heap Occupancy Percentage triggers.</li>
                <li>This value is usually considered a <em class="color2">hard threshold</em>, reaching this limit <em class="color1">will</em> immediately trigger <span class="color2">Initial Mark</span>.</li>
              </ul>
            </li>
          </ul>
          <br/><br/>
          <ul style="font-size: 0.8em">
            <li><strong class="color2">A Humongous allocation is reached</strong>: <br/>
              <ul>
                <li>Humongous objects are objects with a size of <span class="color3">50%</span> or greater than, a region size.</li>
                <li><span class="color2">Directly allocated to Old gen.</span> regions to avoid the potentially costly collections and moves of young gen.</li>
                <li>G1GC tries to eagerly reclaim such objects if they are found to not have references after many collections.</li>
                <li>Can be disabled by a <code>-XX:-G1EagerReclaimHumongousObjects</code>, may need to turn on Experimental options.</li>
              </ul>
            </li>
          </ul>
          <br/>
        </span>
      </section>
  
      <!-- G1GC - Concurrent Marking -->
      <section>
        <h2>G1GC - Concurrent - Marking</h2>
        <table style="width: 100%">
          <tr style="border: hidden">
            <td width="80%" style="text-align: left; vertical-align: middle; border: hidden">
              <span style="font-size:0.55em;text-align:left;">
                <strong><span class="color1">Young-Only - Concurrent Marking</span>: </strong>
                <br/>
                <ul style="font-size: 0.8em">
                  <li>Concurrent process, does not stop application threads.</li>
                  <li><span class="color1">Concurrent Mark</span> begins with a <strong class="color2">Snapshot-At-The-Beginning (SATB)</strong> (<span class="dimtext">remember: conservative garbage collection</span>).</li>
                  <li>If objects move to <span class="color1">Tenured</span> after the SATB, all such objects are <em class="color2">implicitly considered live</em>, and not checked.</li>
                  <li><span class="color1">Young Collection</span> continues during <span class="color1">Concurrent Mark</span>, <span class="color1">Remark</span> and <span class="color1">Cleanup</span>.</li>
                  <li>The <span class="color1">Concurrent Marking</span> process and the <span class="color1">Root scan</span> are frequently halted by periodic <span class="color1">Young Collection</span>s. </li>
                  <li>The completion of the <span class="color1">Concurrent Mark</span> triggers a <strong class="color1">Remark</strong>.</li>
                </ul>
              </span>
            </td>
            <td width="20%" style="text-align: center; vertical-align: middle; border: hidden">
              <img src="images/G1GC_Cycle_ConcurrentMarking.png" width="100%"/>
            </td>
          </tr>
        </table>
        <hr/>
        <table width="100%">
          <tr style="border: hidden">
            <td width="100%" style="text-align: center; vertical-align: middle; border: hidden">
              <img src="images/G1_4_ConcurrentMarking.png" width="45%"/>
            </td>
          </tr>
        </table>
        </span>
      </section>
  
      <!-- G1GC - Concurrent Marking - Pictorial -->
      <section>
        <h2>G1GC - Concurrent Marking - Pictorial</h2>
        <p/>
        <span style="font-size:0.55em;text-align:left;">
          The below pictures show a concurrent mark liveness check (tri-color painting).<br/>
          <strong class="color2">Gray</strong> = To check, <strong class="color2">Black</strong> = Live, <strong class="color2">White</strong> = Dead.
          <table style="font-size: 0.6em;text-align: left; width: 100%">
            
            <tbody>
              <tr>
                <td class="tdfiller">1. Snapshot-at-the-beginning (SATB)</td>
                <td class="tdfiller">2. Objects added/dereferenced</td>
                <td class="tdfiller">3. Root Scan</td>
              </tr>
              <tr>
                <td style="text-align: left; vertical-align: top">
                  <img src="images/ConcurrentMarkSATB.png" width="100%">
                </td>
                <td style="text-align: left; vertical-align: top">
                  <img src="images/ConcurrentMarkNewObject.png" width="100%">
                </td>
                <td style="text-align: left; vertical-align: top">
                  <img src="images/ConcurrentMarkRootScan.png" width="100%">
                </td>
              </tr>
            
              <tr>
                <td class="tdfiller">4. Root Painting</td>
                <td class="tdfiller">5. Children Painting</td>
                <td class="tdfiller">6. Completion</td>
              </tr>
              <tr>
                <td style="text-align: left; vertical-align: top">
                  <img src="images/ConcurrentMarkRootPaint.png" width="100%">
                </td>
                <td style="text-align: left; vertical-align: top">
                  <img src="images/ConcurrentMarkChildrenPaint.png" width="100%">
                </td>
                <td style="text-align: left; vertical-align: top">
                  <img src="images/ConcurrentMarkCompletion.png" width="100%">
                </td>
              </tr>

            </tbody>
          </table>
        </span>
      </section>
  
      <!-- G1GC - Remark -->
      <section>
        <h2>G1GC - Remark</h2>
        <table style="width: 100%">
          <tr style="border: hidden">
            <td width="80%" style="text-align: left; vertical-align: middle; border: hidden">
              <span style="font-size:0.55em;text-align:left;">
                <strong><span class="color1">Young-Only - Remark</span>: </strong>
                <br/>
                <ul style="font-size: 0.9em">
                  <li><span class="color1">Remark</span> is triggered when <span class="color1">Concurrent Marking</span> and <span class="color1">Region scans</span> are completed.</li>
                  <li>Finalizes the marking, performs <span class="color2">global reference processing</span> and <span class="color2">class unloading</span>.</li>
                  <li><strong class="color2">G1</strong> calculates the liveness information concurrently, to be used to perform the next step: <span class="color1">Cleanup</span>.</li>
                </ul>
              </span>
            </td>
            <td width="20%" style="text-align: center; vertical-align: middle; border: hidden">
              <img src="images/G1GC_Cycle_Remark.png" width="100%"/>
            </td>
          </tr>
        </table>
        <hr/>
        <table width="100%">
          <tr style="border: hidden">
            <td width="50%" style="text-align: center; vertical-align: middle; border: hidden">
              <img src="images/G1_5_RemarkBefore.png" width="100%"/>
            </td>
            <td width="50%" style="text-align: center; vertical-align: middle; border: hidden">
              <img src="images/G1_5_RemarkAfter.png" width="100%"/>
            </td>
          </tr>
        </table>
      </section>
  
      <!-- G1GC - Cleanup -->
      <section>
        <h2>G1GC - Cleanup</h2>
        <table style="width: 100%">
          <tr style="border: hidden">
            <td width="80%" style="text-align: left; vertical-align: middle; border: hidden">
              <span style="font-size:0.55em;text-align:left;">
                <strong><span class="color1">Young-Only - Cleanup</span>: </strong>
                <br/>
                <ul style="font-size: 0.9em">
                  <li>Utilizes the liveness summary calculated after the <span class="color1">Remark</span> pause.</li>
                  <li>Updates internal data structures after eliminating de-referenced objects.</li>
                  <li>Reclaims completely empty regions for new allocations.</li>
                  <li>Determines if a <strong class="color2">Space Reclamation</strong> phase should follow (based on heap waste thresholds).</li>
                  <li>Irrespective of the outcome of the above determination, a <span class="color1">Young Collection</span> is triggered right after this pause.</li>
                </ul>
              </span>
            </td>
            <td width="20%" style="text-align: center; vertical-align: middle; border: hidden">
              <img src="images/G1GC_Cycle_Cleanup.png" width="100%"/>
            </td>
          </tr>
        </table>
        <hr/>
        <table width="100%">
          <tr style="border: hidden">
            <td width="100%" style="text-align: center; vertical-align: middle; border: hidden">
              <img src="images/G1_6_Cleanup.png" width="45%"/>
            </td>
          </tr>
        </table>
      </section>
  
      <!-- G1GC - Mixed Collection -->
      <section>
        <h2>G1GC - Mixed Collection</h2>
        <table style="width: 100%">
          <tr style="border: hidden">
            <td width="80%" style="text-align: left; vertical-align: middle; border: hidden">
            <span style="font-size:0.55em;text-align:left;">
              <strong><span class="color1">Space Reclamation - Mixed Collection</span>: </strong>
              <br/>
              <ul style="font-size: 0.9em">
                <li>A <span class="color2">Mixed Collection</span> is triggered when the percentage of waste (garbage) in the heap reaches a certain threshold.</li>
                <li><span class="color2">Mixed Collection</span> involves picking up a few regions (<span class="color1">Eden</span>, <span class="color1">Survivor</span> and a few <span class="color1">Tenured</span>) for collection.</li>
                <li>The combination is made up based on estimated sum of pause-times of the <strong class="color2">Collection Set</strong>.</li>
                <li>Several cycles of <span class="color2">Mixed Collection</span> may run, until the heap waste (garbage) percent is below the set threshold.</li>
                <li>After each collection, the liveness of the <span class="color1">Tenured</span> region objects are re-evaluated.</li>
                <!--<li><span class="color3">NOTE</span>: <span class="color2">Humongous objects</span> are never moved or compacted, only collected or left-alone.</li>-->
              </ul>
              </span>
            </td>
            <td width="20%" style="text-align: center; vertical-align: middle; border: hidden">
              <img src="images/G1GC_Cycle_MixedCollection.png" width="100%"/>
            </td>
          </tr>
        </table>
        <hr/>
        <table width="100%">
          <tr style="border: hidden">
            <td width="50%" style="text-align: center; vertical-align: middle; border: hidden">
              <img src="images/G1_7_MixedCollectionBefore.png" width="100%"/>
            </td>
            <td width="50%" style="text-align: center; vertical-align: middle; border: hidden">
              <img src="images/G1_7_MixedCollectionAfter.png" width="100%"/>
            </td>
          </tr>
        </table>
      </section>
  
  
      <section>
        <h2>G1GC - Metaspace</h2>
        <span style="font-size:0.6em;text-align:left;">
          Some notes on MetaSpace versus PermGen:<br/>
          <ul>
            <li style="margin-top: 1.0em"><span class="dimtext">PermGen</span> allocated as a part of JVM Heap.</li>
            <li style="margin-top: 1.0em"><span class="dimtext">PermGen</span> is implicitly bounded since it is allocated at startup.</li>
            <li style="margin-top: 1.0em"><span class="dimtext">PermGen</span> could not take advantage of O/S memory swaps.</li>
            <li style="margin-top: 1.0em">Default <span class="dimtext">PermGen</span> size is 64M (85M for 64-bit scaled pointers).</li>
            <hr/>
            <li style="margin-top: 1.0em"><span class="color1">Metaspace</span> (or rather metaspaces) are <span class="color2">not a panacea</span> for <code>OutOfMemoryError</code>s.</li>
            <li style="margin-top: 1.0em"><span class="color1">Metaspace</span> is <span class="color2">explicitly bounded from the O/S memory, taking up unlimited amounts otherwise</span>.</li>
            <li style="margin-top: 1.0em">Initial <span class="color1">Metaspace</span> Size is set by <code>-XX:MetaspaceSize</code> (<span class="dimtext">replaces -XX:PermSize</span>), default = <span class="color3">21.8M</span>.</li>
            <li style="margin-top: 1.0em">Max <span class="color1">Metaspace</span> is set by <code>-XX:MaxMetaspaceSize</code> (<span class="dimtext">replaces -XX:MaxPermSize</span>), default = <span class="color3">unlimited</span>.</li>
            <li style="margin-top: 1.0em">When porting from <span class="dimtext">PermGen</span>, simply replace <code>-XX:PermSize</code> and <code>-XX:MaxPermSize</code> with the new options.</li>
          </ul>
        </span>
        <br/>
      </section>

      <!-- G1GC - Gory Details -->
      <section>
        <h2>G1GC - Gory Details</h2>
        <span style="font-size:0.55em;text-align:left;">
          <span class="color1">Explanation: </span><br/>
          <ul>
            <li style="margin-top: 0.5em"><strong class="color2">Pause time</strong> is used to calculate the mix and is controlled by <code>-XX:MaxGCPauseMillis</code> (default = <span class="color3">200</span>).</li>
            <li style="margin-top: 0.5em"><strong class="color2">Pause time intervals</strong> controlled by an <em class="color2">ergonomic</em> goal that is not initially set.
              <ul>
                <li>controlled by <code>-XX:GCPauseTimeInterval</code> (no default).</li>
              </ul>
            </li>
            <li style="margin-top: 0.5em">G1 continues with the <strong>young collection</strong> <strong class="color2">until either of the below is reached</strong>:
              <ul>
                <li>reaches a configurable <em class="color2">soft</em> limit known as the <code>-XX:InitiatingHeapOccupancyPercent</code> (default = <span class="color3">45</span>).</li>
                <li>reaches the configurable <em class="color2">strict</em> limit of <code>-XX:G1ReservePercent</code> (default = <span class="color3">10</span>).</li>
              </ul>
            </li>
            <li style="margin-top: 0.5em">If either constraint is met, it triggers the start of a <span class="color2">Concurrent GC</span>.</li>
            <li style="margin-top: 0.5em"><span class="color1">Concurrent Mark</span> includes both STW and concurrent activities.</li>
            <li style="margin-top: 0.5em"><span class="color1">Concurrent Mark</span> determines liveness of objects on a per-region basis.</li>
            <li style="margin-top: 0.5em">G1 goes after regions that have the most garbage, it is called <strong class="color1">Garbage-First</strong>.</li>
            <li style="margin-top: 0.5em"><span class="color1">Concurrent Mark</span> is followed by a <span class="color1">Remark</span> and a <span class="color1">Cleanup</span>.</li>
            <li style="margin-top: 0.5em"><span class="color1">Cleanup</span> activity is used to determine if a <span class="color2">Space Reclamation</span> is needed.</li>
            <li style="margin-top: 0.5em">Checks the percentage of garbage (waste) space to be below <code>-XX:G1HeapWastePercent</code> (default = <span class="color3">5</span>).</li>
            <li style="margin-top: 0.5em">Collector picks up a minimum number of regions based on <code>-XX:G1MixedGCCountTarget</code> (default = <span class="color3">8</span>).
              <ul>
                <li>The total number of tenured regions are divided by the above number and are picked up for collection.</li>
              </ul>
            </li>
            <li style="margin-top: 0.5em">After each collection, the liveness of the tenured region is re-evaluated.</li>
            <li style="margin-top: 0.5em">Continues <span class="color2">Space Reclamation</span> if the waste percentage is still greater than the <code>-XX:G1HeapWastePercent</code>.</li>
          </ul>
        </span>
      </section>
      
    </section>
  
    <!-- GC - Summary -->
    <section>
      <h2>Generational Garbage Collection - Summary</h2>

      <span style="font-size:0.6em;text-align:left;">Common JVM options to use a specific collector:</span><br/>
      <table style="font-size: 0.55em;text-align: left;width: 90%">
        <thead>
          <tr>
            <th style="text-align: center; width: 15%">Type</th>
            <th style="text-align: center; width: 15%">Young GC</th>
            <th style="text-align: center; width: 15%">Tenured GC</th>
            <th style="text-align: left;">JVM Option</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td style="text-align: center; vertical-align: middle"><strong class="color1">Serial GC</strong></td>
            <td style="text-align: center; vertical-align: middle">Serial</td>
            <td style="text-align: center; vertical-align: middle">Serial</td>
            <td style="text-align: left; vertical-align: middle"><code>-XX:+UseSerialGC</code></td>
          </tr>
        
          <tr>
            <td style="text-align: center; vertical-align: middle"><strong class="color1">Parallel GC</strong></td>
            <td style="text-align: center; vertical-align: middle">Parallel <span style="font-size: 0.6em">Scavenge</span></td>
            <td style="text-align: center; vertical-align: middle">Parallel</td>
            <td style="text-align: left; vertical-align: middle"><code>-XX:+UseParallelGC -XX:+UseParallelOldGC</code></td>
          </tr>
        
          <tr>
            <td style="text-align: center; vertical-align: middle"><strong class="dimtext">CMS GC</strong></td>
            <td style="text-align: center; vertical-align: middle; text-decoration: line-through;">Parallel <span style="font-size: 0.6em">New</span></td>
            <td style="text-align: center; vertical-align: middle; text-decoration: line-through;">CMS</td>
            <td style="text-align: left; vertical-align: middle"><code class="dimtext">-XX:+UseParNewGC -XX:+UseConcMarkSweepGC</code></td>
          </tr>
        
          <tr>
            <td style="text-align: center; vertical-align: middle"><strong class="color1">G1 GC</strong></td>
            <td style="text-align: center; vertical-align: middle" colspan="2">G1GC</td>
            <td style="text-align: left; vertical-align: middle"><code>-XX:+UseG1GC</code></td>
          </tr>
        
        </tbody>
      </table>
      <span style="font-size:0.7em;text-align:center;"><strong class="color2">NOTE</strong>: <span class="color3">CMS is deprecated as of Java 9.</span></span>
      <br/>
      <span style="font-size:0.6em;text-align:left;">Differences in collectors:</span><br/>
      <table style="font-size: 0.55em;text-align: left;width: 90%">
        <thead>
        <tr>
          <th style="text-align: center; width: 13%">Type</th>
          <th style="text-align: center; width: 12%">Parallel</th>
          <th style="text-align: center; width: 12%">Concurrent</th>
          <th style="text-align: center; width: 16%">Young GC</th>
          <th style="text-align: center; width: 16%">Tenured GC</th>
          <th style="text-align: center; width: 31%">Feature</th>
        </tr>
        </thead>
        
  
        <tbody>
        <tr>
          <td style="text-align: center; vertical-align: middle"><strong class="color1">Serial GC</strong></td>
          <td style="text-align: center; vertical-align: middle">&nbsp - &nbsp;</td>
          <td style="text-align: center; vertical-align: middle">&nbsp - &nbsp;</td>
          <td style="text-align: center; vertical-align: middle">Serial</td>
          <td style="text-align: center; vertical-align: middle">Serial</td>
          <td style="text-align: center; vertical-align: middle">Batch processing</td>
        </tr>
  
        <tr>
          <td style="text-align: center; vertical-align: middle"><strong class="color1">Parallel GC</strong></td>
          <td style="text-align: center; vertical-align: middle">Yes</td>
          <td style="text-align: center; vertical-align: middle">&nbsp - &nbsp;</td>
          <td style="text-align: center; vertical-align: middle">Parallel</td>
          <td style="text-align: center; vertical-align: middle">Parallel</td>
          <td style="text-align: center; vertical-align: middle">High throughput</td>
        </tr>
  
        <tr>
          <td style="text-align: center; vertical-align: middle"><strong class="dimtext">CMS GC</strong></td>
          <td style="text-align: center; vertical-align: middle; text-decoration: line-through;"><span class="dimtext">Yes</span></td>
          <td style="text-align: center; vertical-align: middle; text-decoration: line-through;"><span class="dimtext">Yes</span></td>
          <td style="text-align: center; vertical-align: middle; text-decoration: line-through;"><span class="dimtext">Parallel</span></td>
          <td style="text-align: center; vertical-align: middle; text-decoration: line-through;"><span class="dimtext">Parallel & Conc.</span></td>
          <td style="text-align: center; vertical-align: middle; text-decoration: line-through;"><span class="dimtext">Low Pause</span></td>
        </tr>
  
        <tr>
          <td style="text-align: center; vertical-align: middle"><strong class="color1">G1 GC</strong></td>
          <td style="text-align: center; vertical-align: middle">Yes</td>
          <td style="text-align: center; vertical-align: middle">Yes</td>
          <td style="text-align: center; vertical-align: middle">Parallel</td>
          <td style="text-align: center; vertical-align: middle">Parallel & Conc.</td>
          <td style="text-align: center; vertical-align: middle">Low pause & High throughput</td>
        </tr>
        </tbody>
      </table>
      <br/>
      <span class="dimtext"><span style="font-size: 0.35em; display: block; text-align: center">
        Recommended reading material: <a href="https://blogs.oracle.com/jonthecollector/our-collectors">https://blogs.oracle.com/jonthecollector/our-collectors</a>.
      </span></span>
    </section>
    
    
    <!-- G1GC - Logging Options -->
    <section>
  
      <!-- G1GC - Logging Options -->
      <section>
        <h2>G1GC - Logging Options</h2>
        <span style="font-size:0.5em;text-align:left;">
          In this section salient logging setup options are discussed.
        </span>
      </section>
  
      <!-- G1GC - Check Default Values -->
      <section>
        <h2>G1GC - Check Default Values</h2>
        <span style="font-size:0.6em;text-align:left;">
          <p/>G1GC has several options that can be tuned for performance.
          <ul>
            <li style="margin-top: 1.0em">Finding out what flags exist and what their default values are, is important.</li><br/>
            <li style="margin-top: 1.0em"><span class="color2">Print initial defaults for the operating system</span> (<span class="dimtext">caution, this is a long list, best to redirect to a file</span>):
              <br/>&nbsp;&nbsp;&nbsp;&nbsp;<code>java -XX:+PrintFlagsInitial -version</code>
              <br/>&nbsp;&nbsp;&nbsp;&nbsp;<code>java -XX:+PrintFlagsInitial MyApplication</code></li><br/>
            <li style="margin-top: 1.0em"><span class="color2">Print final defaults for the jvm, with overrides on the defaults</span> (<span class="dimtext">caution, this is a long list, best to redirect to a file</span>):
              <br/>&nbsp;&nbsp;&nbsp;&nbsp;<code>java -XX:+PrintFlagsFinal -version</code>
              <br/>&nbsp;&nbsp;&nbsp;&nbsp;<code>java -XX:+PrintFlagsFinal MyApplication</code></li><br/>
            <li style="margin-top: 1.0em"><span class="color2">Print current flags</span>:
              <br/>&nbsp;&nbsp;&nbsp;&nbsp;<code>java -XX:+PrintCommandLineFlags -version</code>
              <br/>&nbsp;&nbsp;&nbsp;&nbsp;<code>java -XX:+PrintCommandLineFlags MyApplication</code></li><br/>
          </ul>
          <br/>
          <span style="font-size: 0.6em" class="dimtext">The <code>-version</code> is used as the executable above. As is shown, it can be replaced with any java class with a <code>main(...)</code> as well.</span><br/>
        </span>
      </section>
      
      <!-- G1GC - Logging G1GC processes -->
      <section>
        <h2>G1GC - Logging G1GC processes</h2>
    
        <span style="font-size:0.7em;text-align:left;">Common JVM options to print GC logs:</span><br/>
        <span style="font-size:0.5em;text-align:left;">Unified logging changes (for reference use):
          <code>java -Xlog:help</code><br/>
        </span>
        <span style="font-size:0.5em;text-align:left;">
          <span class="dimtext">Understanding the content in the table:</span> <span class="color2">-Xlog</span> : <span class="color2">&lt;tags to log&gt;</span>[<span class="color2">=&lt;log level&gt;</span>]&nbsp[: <span class="color2">&lt;output&gt;</span> [: <span class="color2">&lt;decorations&gt; </span>]]
        </span>
        <br/>
        <table style="font-size: 0.45em;text-align: left;width: 100%">
          
          <thead>
          <tr>
            <th style="text-align: center; width: 8%">GC Type</th>
            <th style="text-align: center; width: 40% ">Option</th>
            <th style="text-align: center; width: 52%">Meaning</th>
          </tr>
          </thead>
          
          <tbody>
          <tr class="dimtext">
            <td style="text-align: center; vertical-align: middle; ">Pre-G1GC</td>
            <td style="text-align: left; vertical-align: middle; "><span class="dimtext">-Xloggc:/path/to/gc.log</span></td>
            <td style="text-align: left; vertical-align: middle; ">Destination path for the logs.</td>
          </tr>

          <tr class="dimtext">
            <td style="text-align: center; vertical-align: middle">Pre-G1GC</td>
            <td style="text-align: left; vertical-align: middle"><span class="dimtext">-XX:+PrintGCDetails</span></td>
            <td style="text-align: left; vertical-align: middle">Increases the verbosity of logged content. </td>
          </tr>

          <tr class="dimtext">
            <td style="text-align: center; vertical-align: middle">Pre-G1GC</td>
            <td style="text-align: left; vertical-align: middle"><span class="dimtext">-XX:+PrintGCDateStamps</span></td>
            <td style="text-align: left; vertical-align: middle">Log date and timestamp of the collection.</td>
          </tr>

          <tr>
            <td class="tdfiller" colspan="3"></td>
          </tr>

          <tr>
            <td style="text-align: center; vertical-align: middle">G1GC</td>
            <td style="text-align: left; vertical-align: middle"><code>-Xlog:gc</code></td>
            <td style="text-align: left; vertical-align: middle">Log messages with <strong class="color2">gc</strong> tag using <strong class="color2">info</strong> level to stdout, with default decorations.</td>
          </tr>

          <tr>
            <td style="text-align: center; vertical-align: middle">G1GC</td>
            <td style="text-align: left; vertical-align: middle"><code>-Xlog:gc,safepoint</code></td>
            <td style="text-align: left; vertical-align: middle">Log messages with <em class="color3">either</em> <strong class="color2">gc</strong> <em class="color3">or</em> <strong class="color2">safepoint</strong> tags (exclusive), both using 'info' level, to stdout, with default decorations.</td>
          </tr>
          
          <tr>
            <td style="text-align: center; vertical-align: middle">G1GC</td>
            <td style="text-align: left; vertical-align: middle"><code>-Xlog:gc+ref=debug</code></td>
            <td style="text-align: left; vertical-align: middle">Log messages with <em class="color3">both</em> <strong class="color2">gc</strong> <em class="color3">and</em> <strong class="color2">ref</strong> tags, using <strong class="color2">debug</strong> level, to stdout, with default decorations.</td>
          </tr>
          
          <tr>
            <td style="text-align: center; vertical-align: middle">G1GC</td>
            <td style="text-align: left; vertical-align: middle"><code>-Xlog:gc=debug:file=gc.txt:none</code></td>
            <td style="text-align: left; vertical-align: middle">Log messages with <strong class="color2">gc</strong> tag using <strong class="color2">debug</strong> level to file <strong class="color2">gc.txt</strong> with <strong class="color2">no</strong> decorations.</td>
          </tr>

          <tr>
            <td style="text-align: center; vertical-align: middle">G1GC</td>
            <td style="text-align: left; vertical-align: middle"><code>-Xlog:gc=trace:file=gc.txt:uptimemillis, pids:filecount=5,filesize=1m</code></td>
            <td style="text-align: left; vertical-align: middle">Log messages with <strong class="color2">gc</strong> tag using <strong class="color2">trace</strong> level to a <strong class="color2">rotating logs of 5 files</strong> of size <strong class="color2">1MB</strong>,
              using the base name <strong class="color2">gc.txt</strong>, with <strong class="color2">uptimemillis</strong> and <strong class="color2">pid</strong> decorations.</td>
          </tr>

          <tr>
            <td style="text-align: center; vertical-align: middle">G1GC</td>
            <td style="text-align: left; vertical-align: middle"><code>-Xlog:gc::uptime,tid</code></td>
            <td style="text-align: left; vertical-align: middle">Log messages with <strong class="color2">gc</strong> tag using <strong class="color2">info</strong> level to output <strong class="color2">stdout</strong>, using <strong class="color2">uptime</strong> and <strong class="color2">tid</strong> decorations.</td>
          </tr>

          <tr>
            <td style="text-align: center; vertical-align: middle">G1GC</td>
            <td style="text-align: left; vertical-align: middle"><code>-Xlog:gc*=info,safepoint*=off</code></td>
            <td style="text-align: left; vertical-align: middle">Log messages with at least <strong class="color2">gc</strong> using <strong class="color2">info</strong> level, but turn off logging of messages tagged with <strong class="color2">safepoint</strong>.</td>
          </tr>
          </tbody>
        </table>
        <br/>
        <span class="dimtext"><span style="font-size: 0.35em; display: block; text-align: center">
        Recommended slide deck: <a href="https://www.slideshare.net/PoonamBajaj5/lets-learn-to-talk-to-gc-logs-in-java-9">https://www.slideshare.net/PoonamBajaj5/lets-learn-to-talk-to-gc-logs-in-java-9</a>.
        </span></span>
      </section>
      
      <!-- G1GC - Common tags -->
      <section>
        <h2>G1GC - Common tags</h2>
        <span style="font-size:0.45em;text-align:left;">Some common tags used in logging:</span>
        <table width="60%" style="font-size: 0.4em">
          <tr><td width="50%" style="text-align: right">Region</td><td><code>region</code></td></tr>
          <tr><td width="50%" style="text-align: right">Liveness </td><td><code>liveness</code></td></tr>
          <tr><td width="50%" style="text-align: right">Marking </td><td><code>marking</code></td></tr>
          <tr><td width="50%" style="text-align: right">Remembered Set </td><td><code>remset</code></td></tr>
          <tr><td width="50%" style="text-align: right">Ergonomics </td><td><code>ergo</code></td></tr>
          <tr><td width="50%" style="text-align: right">Class Histogram </td><td><code>classhisto</code></td></tr>
          <tr><td width="50%" style="text-align: right">Safepoint </td><td><code>safepoint</code></td></tr>
          <tr><td width="50%" style="text-align: right">Task </td><td><code>task</code></td></tr>
          <tr><td width="50%" style="text-align: right">Heap </td><td><code>heap</code></td></tr>
          <tr><td width="50%" style="text-align: right">JNI </td><td><code>jni</code></td></tr>
          <tr><td width="50%" style="text-align: right">Promotion(Parallel) Local Allocation Buffer</td><td><code>plab</code></td></tr>
          <tr><td width="50%" style="text-align: right">Promotion </td><td><code>promotion</code></td></tr>
          <tr><td width="50%" style="text-align: right">Reference </td><td><code>ref</code></td></tr>
          <tr><td width="50%" style="text-align: right">String Deduplication </td><td><code>stringdedup</code></td></tr>
          <tr><td width="50%" style="text-align: right">Statistics</td><td><code>stats</code></td></tr>
          <tr><td width="50%" style="text-align: right">Tenuring </td><td><code>age</code></td></tr>
          <tr><td width="50%" style="text-align: right">Thread Local Allocation Buffer </td><td><code>tlab</code></td></tr>
          <tr><td width="50%" style="text-align: right">Metaspace </td><td><code>metaspace</code></td></tr>
          <tr><td width="50%" style="text-align: right">Humongous Allocation </td><td><code>alloc</code></td></tr>
          <tr><td width="50%" style="text-align: right">Refinement </td><td><code>refine</code></td></tr>
          <tr><td width="50%" style="text-align: right">Humongous </td><td><code>humongous</code></td></tr>
          <tr><td width="50%" style="text-align: right">String Symbol Table </td><td><code>stringtable</code></td></tr>
        </table>
      </section>

    </section>
  
    <!-- G1GC - Performance definitions -->
    <section>
  
      <!-- G1GC - Common Tuning Situations -->
      <section>
        <h2>G1GC - Common Tuning Situations</h2>
        <span style="font-size:0.65em;text-align:left;">
          In this section some tuning options for common issues are discussed.
        </span>
        <br/>
        <span style="font-size:0.65em;text-align:left;">
          <strong class="color1">Before we get there &hellip;</strong><br/>
          <span>JVM optimizes for classes of devices. A <strong class="color2">server-class machine</strong> is defined as one with:</span>
          <br/>
          <ul style="font-size: 0.9em">
            <li>two or more physical processors</li>
            <li>two or more GB of physical memory</li>
          </ul>
          <br/>
          <strong><span class="color1">Some defaults for a server-class machine</span>: </strong>
          <br/>
          <ol style="font-size: 0.9em">
            <li>Default garbage collector = <strong class="color2">G1GC</strong>.</li>
            <li><span class="color2">Initial heap size</span> defaults to <span class="color3">1/64th</span> of physical memory.</li>
            <li><span class="color2">Maximum heap size</span> defaults to <span class="color3">1/4th</span> of physical memory.</li>
            <li>Default tiered compiler with <strong class="color2">C1</strong> and <strong class="color2">C2</strong> code caches.
              <ul>
                <li><span class="color2">C1</span> pre-compiles and optimizes non-profiled (non-dynamic) code.</li>
                <li><span class="color2">C2</span> profiles code and defers optimizations.</li>
              </ul>
            </li>
          </ol>
          <br/>
          JVM uses <em class="color1">ergonomics</em> to determine behaviour and environment-based heuristics to improve performance.
        </span>
      </section>
  
      <!-- G1GC - Performance definitions -->
      <section>
        <h2>G1GC - Performance definitions</h2>
        <span style="font-size:0.6em;text-align:left;">
          G1GC tuning is done to meet one of the below performance metrics:<br/>
          <br/>
          <ul>
            <li><strong class="color1">Throughput</strong>â€”the percentage of total time not spent in garbage collection, considered over long periods of time.</li><br/>
            <li><strong class="color1">Pause time</strong>â€”the length of time the application execution is stopped for garbage collection to occur.</li><br/>
            <li><strong class="color2">GC overhead</strong>â€”the inverse of throughput, that is, the percentage of total time spent in garbage collection.</li><br/>
            <li><strong class="color2">Collection frequency</strong>â€”how often collection occurs, relative to application execution.</li><br/>
            <li><strong class="color2">Footprint</strong>â€”a measure of size, such as heap size.</li><br/>
            <li><strong class="color2">Promptness</strong>â€”the time between when an object becomes garbage and when the memory becomes available</li>
          </ul>
        </span>
      </section>
      
      <section>
        <h2>G1GC - How to tune</h2>
        <span style="font-size: 0.75em; text-align: left;">
          There are a few steps to performance tuning happiness. <br/>
          Follow the <span class="color2">EMPATHY</span> model.<p/>
          <ol>
            <li><span class="color2">E</span><span >xecute</span> - <span class="dimtext">execute the application to determine issues visually.</span></li>
            <li><span class="color2">M</span><span >onitor</span> - <span class="dimtext">use appropriate alerts/tools/logs to monitor.</span></li>
            <li><span class="color2">P</span><span >rofile</span> - <span class="dimtext">identify the areas that need special attention.</span></li>
            <li><span class="color2">A</span><span >nalyze</span> - <span class="dimtext">determine what needs to be done to fix issues.</span></li>
            <li><span class="color2">T</span><span >une</span> - <span class="dimtext">set the right parameters for sizes, ages, threads etc.</span></li>
            <li><span class="color2">H</span><span >ammer</span> - <span class="dimtext">test out each set of parameters thoroughly.</span></li>
            <li><span class="color2">Y</span><span >ippee</span> - <span class="dimtext">beer time.</span> ðŸ»</li>
          </ol>
        </span>
        <hr/>
        <span style="font-size:0.7em;text-align:left;">
          If you decide to increase the number of parallel threads to gain performance, remember that:
        </span><br/>
        <span style="font-size:0.7em;text-align:left;">
          <strong class="color3">Amdahl&rsquor;s Law:</strong><br/>
          <em class="dimtext" style="font-size:0.8em;text-align:left;">
            ... the nature of this overhead (in parallelism) appears to be sequential so that
            it is unlikely to be amenable to parallel processing techniques.
          </em>
        </span>
        <p/>
        <span style="font-size:0.5em;text-align:left;">
          <strong class="color3">Chandra&rsquor;s Law <span style="font-size: 1.3em">ðŸ¤“</span>:</strong><br/>
          <em class="dimtext" style="font-size:0.9em;text-align:left;">
            Providing three copies of a book does not get a person read it three times faster.
          </em>
        </span>
      </section>
      
      <!-- G1GC - Frequent Full GC< -->
      <section>
        <h2>G1GC - Frequent Full GC</h2>
        <span style="font-size:0.7em;text-align:left;">
          <strong class="color2">Frequent Full GCs are observed</strong> <br/>
          <ul><br/>
            <li>Usually caused by heavy heap occupancy.</li><br/>
            <li>Logs contain the phrase <em class="color2">Pause Full (Allocation Failure)</em>.</li><br/>
            <li>This is typically preceded by a <span class="color2">to-space exhausted</span> message.</li><br/>
            <li>Steps to mitigate:
              <ul style="font-size: 0.9em">
                <li>Try to reduce the humongous objects.</li>
                <li>Increase the java heap region size (by <code>-XX:G1HeapRegionSize</code>).</li>
                <li>Increase number of concurrent threads (by <code>-XX:ConcGCThreads</code>).</li>
                <li>Force earlier marking by either:
                  <ul style="font-size: 0.9em">
                    <li>Lower the <code>-XX:G1ReservePercent</code></li>
                    <li>Disable the <code>-XX:G1UseAdaptiveIHOP</code> and manually set <code>-XX:InitiatingHeapOccupancyPercent</code>.</li>
                  </ul>
                </li>
              </ul>
            </li>
            <br/>
            <li>
              Full GCs can also be caused by <code>System.gc()</code> calls in some library.
              <br/>
              Effects of such can be mitigated by:<br/>
              <ul style="font-size: 0.9em">
                <li>Full GC frequency can be mitigated by <code>-XX:ExplicitGCInvokesConcurrent</code>.</li>
                <li>Last resort, completely ignore <code>gc()</code> calls with <code>-XX:DisableExplicitGC</code>.</li>
              </ul>
            </li>
          </ul>
        </span>
      </section>
      
      <!-- G1GC - Long Young Collection -->
      <section>
        <h2>G1GC - Long Young Collection</h2>
        <span style="font-size:0.7em;text-align:left;">
          <strong class="color2">Young Collections seem to take too long</strong> <br/>
          <ul><br/>
            <li>Young collection time is proportional to the size of the young generation.</li><br/>
            <li>Reducing the <code>-XX:G1NewSizePercent</code> reduces the young generation size.</li><br/>
            <li>Sudden spikes in the application may cause influx of live objects.</li><br/>
            <li>Limiting the maximum size of the young generation can help.</li><br/>
            <li>Maximum young generation size can be controlled by <code>-XX:G1MaxNewSizePercent</code>.</li><br/>
          </ul>
        </span>
      </section>
      
      <!-- G1GC - Long Mixed Collection -->
      <section>
        <h2>G1GC - Long Mixed Collection</h2>
        <span style="font-size:0.7em;text-align:left;">
          <strong class="color2">Mixed Collections seem to take too long</strong> <br/>
          <ul style="font-size: 0.9em"><br/>
            <li>Determine which generation is taking the time (Set <code class="color2">gc+ergo+cset=trace</code> in logging).</li><br/>
            <li>The logs will then show <em class="color2">predicted young region</em> and <em class="color2">predicted old region</em> times.</li><br/>
            <li>Spread reclamations to <em class="color2">more</em> mixed collections via <code>-XX:G1MixedGCCountTarget</code>.</li><br/>
            <li>Alter (typically: reduce) threshold of collecting regions with high live occupancy: <br/><code style="font-size: 1.0em">-XX:G1MixedGCLiveThresholdPercent</code>.</li><br/>
            <li>Alter (typically: reduce) space reclamation in high occupancy regions via <code>-XX:G1HeapWastePercent</code>.</li><br/>
          </ul>
        </span>
      </section>
    </section>
    
    <section>
     
      <!-- Garbage Collection - Future -->
      <section>
        <h2>What's next in Garbage Collection?</h2>
        <span style="font-size:0.65em;text-align:left;">
          <p/>This section will list a few new garbage collectors with their offered features.
        </span>
      </section>
  
      <!-- Garbage Collection - Shenandoah -->
      <section>
        <h2>Shenandoah</h2>
        <span style="font-size:0.75em;text-align:left;">
          <span class="dimtext">(Redhat &#8674; OpenJDK)</span><p/>
          <ul style="font-size: 0.7em"><br/>
            <li><span class="color2">Region-based, non-generational collector</span>, based on the G1GC.</li><br/>
            <li>Adds an indirection, called <span class="color1">Brooks Pointer</span> (<span class="color3"><sub>*</sub> &darr;</span>) to each object, GC threads can compact heap while app is running.</li><br/>
            <li>Young collection equivalent is run in a <strong class="color1">concurrent-partial</strong> mode.</li><br/>
            <li>Uses a <strong class="color1">concurrent mark</strong> and a <strong class="color1">concurrent compact</strong> for longer lived objects.</li><br/>
            <li>Evacuation and reference updates to <span class="color2">run concurrently with application threads</span>.</li><br/>
            <li>In case of slower collection cycles, more cycles are stolen from application, but application is not halted.</li><br/>
            <li>Pause times to be <em class="color2">independent of heap size</em> (be it <span class="color3">2GB</span> or even <span class="color3">100GB</span>).</li><br/>
            <li>Already being improved <span class="dimtext">(v2.0)</span> to focus GC on regions where the writes happen.</li><br/>
            <li>Best suited where responsiveness and predictable pauses <em class="color2">are valued over</em> more cpu cycles and space.</li><br/>
            <li>More reading material:<br/>
              <ul style="font-size: 0.8em">
                <li><a href="http://openjdk.java.net/jeps/189">JEP-189 (http://openjdk.java.net/jeps/189)</a></li>
                <li><a href="https://wiki.openjdk.java.net/display/shenandoah/Main">Shenandoah Wiki (https://wiki.openjdk.java.net/display/shenandoah/Main)</a></li>
                <li>(<span class="color3"><sub>*</sub></span>) <a href="https://rkennke.wordpress.com/2013/10/23/shenandoah-gc-brooks-pointers/">Shenandoah GC: Brooks pointers (https://rkennke.wordpress.com/2013/10/23/shenandoah-gc-brooks-pointers/)</a></li>
              </ul>
            </li>
          </ul>
        </span>
      </section>
  
      <!-- Garbage Collection - ZGC -->
      <section>
        <h2>ZGC</h2>
        <span style="font-size:0.75em;text-align:left;">
          <span class="dimtext">(Oracle &#8674; OpenJDK)</span><p/>
          <ul style="font-size: 0.7em"><br/>
            <li><span class="color2">Region-based, non-generational collector</span>, based on G1GC.</li><br/>
            <li>Uses <span class="color1">colored pointers</span> with <span class="color1">load barriers</span> (<span class="color3"><sub>*</sub> &darr;</span>) to allow for concurrent ops.</li><br/>
            <li>Load barriers act as the intermediate in determining if the object was relocated.</li><br/>
            <li>Designed for very large memory heaps.</li><br/>
            <li>Low GC pause times, not exceeding <span class="color3">10ms</span>.</li><br/>
            <li>No more than <span class="color3">15%</span> application throughput reduction compared to using G1.</li><br/>
            <li>Aims at simplifying tuning of GCs as well!</li><br/>
            <li>Best suited for large memory usage and predictable throughput while consuming less space.</li><br/>
            <li>More reading material:<br/>
              <ul style="font-size: 0.8em">
                <li><a href="http://openjdk.java.net/projects/zgc/">OpenJDK Project (http://openjdk.java.net/projects/zgc/)</a></li>
                <li><a href="https://wiki.openjdk.java.net/display/zgc/Main">ZGC Wiki (https://wiki.openjdk.java.net/display/zgc/Main)</a></li>
                <li><a href="https://jaxenter.com/zgc-interview-per-liden-139985.html">Per Liden (Lead) Interview (https://jaxenter.com/zgc-interview-per-liden-139985.html)<br/></a>
                <li>(<span class="color3"><sub>*</sub></span>) <a href="https://mechanical-sympathy.blogspot.com/2011/07/memory-barriersfences.html">Memory Barriers/Fences (https://mechanical-sympathy.blogspot.com/2011/07/memory-barriersfences.html)</a></li>
              </ul>
            </li>
          </ul>
        </span>
      </section>
  
      <!-- Garbage Collection - Epsilon -->
      <section>
        <h2>Epsilon (or No GC)</h2>
        <span style="font-size:0.75em;text-align:left;">
          <span class="dimtext">(Redhat &#8674; OpenJDK)</span><p/>
          <ul style="font-size: 0.7em"><br/>
            <li>Handles memory allocation but <em class="color2">does not actually reclaim memory</em>.</li><br/>
            <li><span class="color2">Completely passive GC</span> with just bounded memory allocation and lowest latency guarantees.</li><br/>
            <li>Linear allocation in a single chunk of memory.</li><br/>
            <li>Uses <span class="color2">trivial lock-free</span> <span class="color1">Thread Local Allocation Buffers (TLABs)</span> that do not need managing.</li><br/>
            <li>Popular commercial implementations have a similar NoGC option already.</li><br/>
            <li>Best suited for: <br/>
              <ul>
                <li>performance testing the app (without GC latency).</li>
                <li>extremely short lived jobs.</li>
                <li>memory pressure testing.</li>
              </ul>
            </li><br/>
            <li>More reading material:<br/>
              <ul style="font-size: 0.8em">
                <li><a href="http://openjdk.java.net/jeps/318">JEP-318 (http://openjdk.java.net/jeps/318)</a></li>
                <li><a href="https://www.infoq.com/news/2017/03/java-epsilon-gc">Remove the Garbage Collector (https://www.infoq.com/news/2017/03/java-epsilon-gc)</a></li>
              </ul>
            </li>
          </ul>
        </span>
      </section>

    </section>
    
    <section data-menu-title="Â¯\_(ãƒ„)_/Â¯">
      <h1 style="text-transform: none">Time's up :: Â¯\_(ãƒ„)_/Â¯</h1>
      <span style="font-size:0.7em;text-align:left;margin-left: 50px">
        <table width="100%">
          <tr style="border: hidden; vertical-align: top">
              <img src="images/GarbageCollectorWave.png" width="450px"/>
          </tr>
          <tr style="border: hidden">
            <td style="text-align: center; vertical-align: bottom"><span style="font-size: 1.2em">My contact information</span></td>
          </tr>
        </table>
        <hr/>
        <table width="100%" style="border: hidden">
        
          <tr style="border: hidden">
            <td width="33%" style="text-align:center; font-size:0.65em;border: hidden">Twitter: <br/><a
                href="http://www.twitter.com/cguntur" target="_blank">http://www.twitter.com/cguntur</a>
            </td>
            <td width="33%" style="text-align:center;font-size:0.65em;border: hidden">LinkedIn: <br/><a
                href="http://www.linkedin.com/in/chandraguntur" target="_blank">http://www.linkedin.com/in/chandraguntur</a>
            </td>
            <td width="34%" style="text-align:center;font-size:0.65em;border: hidden">My blog: <br/><a
                href="http://www.cguntur.me" target="_blank">http://www.cguntur.me</a>
            </td>
          </tr>
        
          <tr>
            <td width="33%" style="text-align:center;border: hidden">
              <a href="http://www.twitter.com/cguntur" target="_blank">
                <img src="scaffolding/twitter_qr.png" width="150"/>
              </a>
            </td>
            <td width="33%" style="text-align:center;border: hidden">
              <a href="http://www.linkedin.com/in/chandraguntur" target="_blank">
                <img src="scaffolding/linkedin_qr.png" width="150"/>
              </a>
            </td>
            <td width="34%" style="text-align:center;border: hidden">
              <a href="http://www.cguntur.me" target="_blank">
                <img src="scaffolding/cguntur_qr.png" width="150"/>
              </a>
            </td>
          </tr>
        
        </table>
      </span>
      <br>
      <span class="dimtext"><span style="font-size: 0.25em; display: block; text-align: center">
      LinkedIn and my blog QR codes generated at QRStuff: <a href="http://www.qrstuff.com" target="_blank">http://www.qrstuff.com</a>.
      </span></span>
    </section>
  
  </div>

</div>

<script src="lib/js/head.min.js"></script>
<script src="js/reveal.js"></script>

<script>
    Reveal.initialize({
        controls: true,
        progress: true,
        history: true,
        center: true,
        width: '90%',
        height: '100%',

        transition: Reveal.getQueryHash().transition || 'default',

        menu: {
            markers: true,
            openSlideNumber: true,
            transitions: false,
            themes: [
                {name: 'Dark', theme: 'css/theme/dark.css'},
                {name: 'Medium', theme: 'css/theme/medium.css'},
                {name: 'Light', theme: 'css/theme/light.css'},
                {name: 'White', theme: 'css/theme/white.css'}
            ]
        },
        
        dependencies: [
            {
                src: 'lib/js/classList.js', condition: function () {
                  return !document.body.classList;
                }
            },
            {
                src: 'plugin/markdown/marked.js', condition: function () {
                  return !!document.querySelector('[data-markdown]');
                }
            },
            {
                src: 'plugin/markdown/markdown.js', condition: function () {
                  return !!document.querySelector('[data-markdown]');
                }
            },
            {src: 'plugin/zoom-js/zoom.js', async: true},
            {src: 'plugin/notes/notes.js', async: true},
            {src: 'plugin/mouse-pointer/mouse-pointer.js', async: true },
            // {src: 'plugin/spotlight/spotlight.js'},
            {src: 'plugin/reveal.js-menu/menu.js', async: true}
        ]
    });

    Reveal.configure({slideNumber: 'mystyle'});
    
    if(location.search) {
        var params = location.search.replace("?", "").split("=");
        if(params[0] === "style" && params[1] === "light") {
            document.getElementById('theme').setAttribute('href', 'css/theme/light.css');
        }
        if(params[0] === "style" && params[1] === "white") {
            document.getElementById('theme').setAttribute('href', 'css/theme/white.css');
        }
        if(params[0] === "style" && params[1] === "medium") {
            document.getElementById('theme').setAttribute('href', 'css/theme/medium.css');
        }
        if(params[0] === "style" && params[1] === "dark") {
            document.getElementById('theme').setAttribute('href', 'css/theme/dark.css');
        }
    }
</script>

<div style="position: absolute; bottom: 20px; margin-left: 0px; width: 100%;">
    <div style="text-align: center;">
        <a href="http://www.twitter.com/cguntur" target="_blank" style="text-decoration:none">
            <img src="scaffolding/twitter.svg" style="height:20px; vertical-align:middle"/>&nbsp;&nbsp;<span class="footer">@CGuntur</span>
        </a>
        &nbsp;&nbsp;&nbsp;&nbsp;
        <a href="http://www.linkedin.com/in/chandraguntur" style="text-decoration:none">
            <img src="scaffolding/linkedin.svg" style="height:20px; vertical-align:middle"/>&nbsp;&nbsp;<span class="footer">Chandra Guntur</span>
        </a>
        &nbsp;&nbsp;&nbsp;&nbsp;
        <a href="http://www.cguntur.me" style="text-decoration:none">
            <img src="scaffolding/chandra.png" style="height:20px; vertical-align:middle"/>&nbsp;&nbsp;<span class="footer">http://cguntur.me</span>
        </a>
    </div>
</div>

</body>
</html>
